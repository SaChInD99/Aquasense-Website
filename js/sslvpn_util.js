function fgt_sslvpn_url_trim(url){for(var len=url.length;!url.substr(len-1,len-1).match(/\S/g)&&len>0;)len--;return url.substr(0,len)}function fgt_sslvpn_host_not_encoded(host_str){var re=/^[ZI][a-fA-F0-9]+/;return!re.test(host_str)}function fgt_s_substr_count(haystack,needle,offset,length){var cnt=0;for(haystack+="",needle+="",isNaN(offset)&&(offset=0),isNaN(length)&&(length=0),offset--;(offset=haystack.indexOf(needle,offset+1))!=-1;){if(length>0&&offset+needle.length>length)return!1;cnt++}return cnt}function fgt_s_test_ipv4(ip){var match=ip.match(/(([1-9]?[0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([1-9]?[0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])/);return null!=match}function fgt_s_test_ipv6(ip){if(ip.length<3)return"::"==ip;if(ip.indexOf(".")>0){var lastcolon=ip.lastIndexOf(":");if(!lastcolon||!fgt_s_test_ipv4(ip.substr(lastcolon+1)))return!1;ip=ip.substr(0,lastcolon)+":0:0"}if(ip.indexOf("::")<0){var match=ip.match(/^(?:[a-f0-9]{1,4}:){7}[a-f0-9]{1,4}$/i);return null!=match}if(fgt_s_substr_count(ip,":")<8){var match=ip.match(/^(?::|(?:[a-f0-9]{1,4}:)+):(?:(?:[a-f0-9]{1,4}:)*[a-f0-9]{1,4})?$/i);return null!=match}return!1}function fgt_sslvpn_transform_url_path(val,host_only,app_type){var path,r2,hostname_str,re6,new_host,inputData=val.toLowerCase(),scheme="http",pos=inputData.indexOf("http://"),proxy_url="",base_host=document.location.host,re=/(https?:)?(?:\/\/?)?([^\/]*)(\/?.*)/i,protocol=document.location.protocol,r=re.exec(val),is_ipv6_addr=!1,pattern=/([^\s]*)(\s?-?.*)/i;if(host_only&&fgt_sslvpn_host_not_encoded(val))return r=pattern.exec(val),r&&r[1]&&r[2]?(new_host=fgt_sslvpn_aes_Encrypt(r[1]),proxy_url="Z"+fgt_sslvpn_byteArrayToHex(new_host)+r[2]):(new_host=fgt_sslvpn_aes_Encrypt(val),proxy_url="Z"+fgt_sslvpn_byteArrayToHex(new_host)),proxy_url;if(r&&("ftp"==app_type||"smb"==app_type))return r[2]?(new_host=fgt_sslvpn_aes_Encrypt(r[2]),proxy_url="Z"+fgt_sslvpn_byteArrayToHex(new_host),r[3]&&(proxy_url+=r[3])):(new_host=fgt_sslvpn_aes_Encrypt(r),proxy_url="Z"+fgt_sslvpn_byteArrayToHex(new_host)),proxy_url;if(r&&(re6=/(\[[^\]]*\]):?([0-9]*)/,re=/([^\:]*):([0-9]+)/,r2=re6.exec(r[2]),r2?is_ipv6_addr=!0:r2=re.exec(r[2]),r2&&(null==r2[2]||"https:"==protocol&&443==r2[2]||"http:"==protocol&&80==r2[2])&&(r[2]=r2[1]),((!r[1]||0==r[1].length)&&"http:"!=protocol||r[1]&&r[1].length>0&&protocol!=r[1])&&(r[2]="")),r&&r[2]==base_host)proxy_url=protocol+"//"+r[2]+r[3];else{if(0==pos?(scheme="http",inputData=val.substring(7,val.length)):(pos=inputData.indexOf("https://"),0==pos?(scheme="https",inputData=val.substring(8,val.length)):inputData=val),pos=inputData.indexOf("/"),pos==-1&&(inputData+="/"),fgt_sslvpn_var3){var already_encoded=!1;pos=inputData.indexOf("/"),fgt_sslvpn_host_not_encoded(inputData.substring(0,pos))?(path=fgt_sslvpn_aes_Encrypt(inputData.substring(0,pos)),inputData=inputData.substring(pos)):already_encoded=!0,0==already_encoded&&(inputData="Z"+fgt_sslvpn_byteArrayToHex(path)+inputData)}else is_ipv6_addr&&(pos=inputData.indexOf("/"),fgt_sslvpn_host_not_encoded(inputData.substring(0,pos))&&(inputData="I"+fgt_string_encode(inputData.substring(0,pos))+inputData.substring(pos)));hostname_str=fgt_s_test_ipv6(document.location.hostname)?"["+document.location.hostname+"]":document.location.hostname,proxy_url=0==document.location.port.length?document.location.protocol+"//"+hostname_str+"/proxy/"+fgt_sslvpn_sid+"/"+scheme+"/"+inputData:document.location.protocol+"//"+hostname_str+":"+document.location.port+"/proxy/"+fgt_sslvpn_sid+"/"+scheme+"/"+inputData}return proxy_url}function transform_url(val){var proxy_url=fgt_sslvpn_transform_url_path(val,!1,"web");return proxy_url}function format_ipv6_url(url){return fgt_s_test_ipv6(url)&&(url="["+url+"]"),url}function fgt_string_encode(str){for(var h,out="",i=0;i<str.length;++i)h=str.charCodeAt(i).toString(16),h.length<2&&(h="0"+h),out+=h;return out}function fgt_string_decode(str){for(var out="",i=0;i<str.length;i+=2)out+=String.fromCharCode(parseInt(str.substring(i,i+2),16));return out}function fgt_trim(str){return str.replace(/^\s+|\s+$/g,"")}